@model IEnumerable<Web.ITroc.Core.ViewModels.AdsToIndexViewModel>
@{
    ViewBag.Title = "Home Page";
}

@Html.Partial("_AdInfoMod2")

<section class="text-center">
    <h2 class="mb-5 font-weight-bold">Annonces</h2>


    <div id="show-ads" class="view">
        <div class="ads">
            <div class="container d-flex ">
                <div class="row">
                    @foreach (var ad in Model)
                    {
                        <div class="col-lg-6 col-md-6">
                            <div class="card card-cascade narrower blue lighten-3 hoverable" data-toggle="modal" data-target="#modalQuickView" onclick="imageTrigger(@ad.Id)">
                                <div class="view view-cascade overlay">
                                    <img src="@($"data:image/png;base64,{@ad.PhotoAd}")" class="img-fluid card-img-top" alt="@ad.AdTitle">
                                    <a>
                                        <div class="mask rgba-amber-slight"></div>
                                    </a>
                                </div>
                                <div class="card-body card-body-cascade ">
                                    <div class="date view overlay">
                                        <div class="month">
                                            @ad.AdCreate.ToString("MMM")
                                        </div>
                                        <div class="day">
                                            @ad.AdCreate.ToString("d ")
                                        </div>
                                    </div>
                                    <h4 class="card-title">@ad.AdTitle</h4>
                                    <p class="card-text text-muted">@ad.AdDescription</p>
                                </div>
                            </div>
                            <hr class="my-5" />
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>



@section scripts{

    <script>
        $(document).ready(function () {
            $('.mdb-select').materialSelect();
            //---------------show MODALS
            //$(function() {
            //    $("a[data-modal]").on("click",
            //        function() {
            //            $("#partsModalContent").load(this.href, function() {
            //                $("partsModal").Modal({ keyboard: true }, "show");
            //            });
            //            return false;
            //        });
            //});
        });


        function imageTrigger(id) {
            $.ajax({
                url: "/api/ApiCollection/GetAdInfoToModal?id=" + id,
                type: "GET",
                dataType: "json",
                success: function(data) {
                    if (data && data[0]) {

                        //$(".modaltitle").html(data[0].AdTitle);

                        $('.carousel-inner').empty();
                        $('.carousel-indicators').empty();
                        $(".product-name").empty();
                        $(".green-text").empty();
                        var dateAd = new Date(data[0].AdCeate);

                        $(".product-name").append('<strong>' + data[0].AdTitle + '</strong>');
                        $(".green-text").append('<strong>' + data[0].AdCeate+'</strong>');

                        $('.carousel-inner').append('<div class="carousel-item active"><img class="d-block w-100 monimage1"  src="data:image/png;base64,' + data[0].Images[0] + '"alt="First slide"></div>');
                        $('.carousel-indicators').append('<li data-target="#carousel-thumb" data-slide-to="0" class="active"><img class="d-block monimage2"  src="data:image/png;base64,' + data[0].Images[0] +'"></li>');

                        for (var i = 0; i < data[0].Images.length; i++) {
                            $('.carousel-inner').append(
                                    '<div class="carousel-item"><img class="d-block w-100 monimage1" src="data:image/png;base64,' +
                                data[0].Images[i] + '"alt="Second slide" ></div>');
                        }
                        for (var j = 1; j < data[0].Images.length; j++) {
                            $('.carousel-indicators').append('<li data-target="#carousel-thumb" data-slide-to="' + (j + 1) + '"><img class="mx-auto d-block  monimage2 avatar z-depth-1 img-fluid"  src="data:image/png;base64,' + data[0].Images[j] + '"></li>');
                        }


                        //$('.smallimage').on("click", function () {
                        //    $('.bigimage').attr('src', $(this).attr('src'));
                        //});
                    } else if (data[0] === undefined) {
                        alert("NOK");
                        //window.location.href = '/';
                    }
                }
            });
        }
    </script>

}
    